openapi: 3.0.0
info:
  title: DeepBounty API
  version: 1.0.0
  description: DeepBounty API Documentation

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: connect.sid
    burpsuiteKey:
      type: http
      scheme: bearer
      bearerFormat: API Key
      description: Burp Suite API key

paths:
  #Setup
  /setup/password:
    post:
      summary: Set up a password to protect the dashboard
      tags:
        - Setup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  minLength: 12
                  pattern: "^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[^A-Za-z0-9]).+$"
      responses:
        "200":
          description: Password setup successful
          headers:
            Set-Cookie:
              description: Session cookie when the password is set up
              schema:
                type: string
              example: "connect.sid=abc123; Path=/; HttpOnly; SameSite=Lax; Secure"
        "400":
          description: Invalid password
  #Auth
  /auth/login:
    post:
      summary: User login
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
      responses:
        "200":
          description: Login successful
          headers:
            Set-Cookie:
              description: Session cookie set on successful login
              schema:
                type: string
              example: "connect.sid=abc123; Path=/; HttpOnly; SameSite=Lax; Secure"
        "401":
          description: Invalid password
  /auth/logout:
    post:
      summary: User logout
      tags:
        - Auth
      responses:
        "200":
          description: Logout successful
  /auth/info:
    get:
      summary: Get current authentication info
      tags:
        - Auth
      responses:
        "200":
          description: Authentication status
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  status:
                    type: string
                    description: Current auth status. Depends on whether setup is complete and whether a valid session cookie is present.
                    enum: [authenticated, unauthenticated, setup-required]
  #Targets
  /targets:
    get:
      summary: Retrieve a list of targets
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of targets
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: "Target Name"
                    domain:
                      type: string
                      example: "example.com"
                    activeScan:
                      type: boolean
                      example: true
        "401":
          description: Unauthorized
    post:
      summary: Add a new target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - domain
              properties:
                name:
                  type: string
                  example: "New Target"
                domain:
                  type: string
                  example: "example.com"
                activeScan:
                  type: boolean
                  example: true
      responses:
        "201":
          description: Target created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 2
                  name:
                    type: string
                    example: "New Target"
                  domain:
                    type: string
                    example: "example.com"
                  activeScan:
                    type: boolean
                    example: true
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /targets/full:
    get:
      summary: Retrieve all targets with their subdomains and settings
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of targets with relations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: "Target Name"
                    domain:
                      type: string
                      example: "example.com"
                    activeScan:
                      type: boolean
                      example: true
                    subdomains:
                      type: array
                      items:
                        type: string
                      example: ["a.example.com", "b.example.com"]
                    settings:
                      type: object
                      nullable: true
                      description: Arbitrary JSON settings for the target
        "401":
          description: Unauthorized
  /targets/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    patch:
      summary: Update an existing target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Updated Target"
                domain:
                  type: string
                  example: "example.com"
                activeScan:
                  type: boolean
                  example: true
      responses:
        "200":
          description: Target updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: "Updated Target"
                  domain:
                    type: string
                    example: "example.com"
                  activeScan:
                    type: boolean
                    example: true
        "400":
          description: Invalid request
        "404":
          description: Target not found
        "401":
          description: Unauthorized
    delete:
      summary: Delete an existing target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Target deleted successfully
        "404":
          description: Target not found
        "401":
          description: Unauthorized
  /targets/{id}/subdomains:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get subdomains for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of subdomains for the target
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    subdomain:
                      type: string
                      example: "sub.example.com"
                    isOutOfScope:
                      type: boolean
                      example: false
        "401":
          description: Unauthorized
    post:
      summary: Add subdomains to a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  subdomain:
                    type: string
                    example: "sub.example.com"
                  isOutOfScope:
                    type: boolean
                    example: false
      responses:
        "200":
          description: Subdomains added successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /targets/{id}/packages:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get package names for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of package names for the target
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  example: "com.example.app"
        "401":
          description: Unauthorized
    post:
      summary: Add package names to a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  packageName:
                    type: string
                    example: "com.example.app"
      responses:
        "200":
          description: Package names added successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /targets/{id}/settings:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get settings for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Settings rows for the target
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                example: { userAgent: "Mozilla/5.0", customHeader: "X-BugBounty: <username>" }

        "401":
          description: Unauthorized
    post:
      summary: Replace settings for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              example: { userAgent: "Mozilla/5.0", customHeader: "X-BugBounty: <username>" }
      responses:
        "200":
          description: Settings saved successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  # Alerts
  /alerts:
    get:
      summary: Retrieve a list of alerts
      tags:
        - Alerts
      security:
        - sessionCookie: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (1-based)
        - in: query
          name: pageSize
          schema:
            type: integer
            minimum: 1
            maximum: 25
            default: 25
          description: Number of alerts per page (max 25)
        - in: query
          name: search
          schema:
            type: string
          description: Search term to filter alerts by name, domain or subdomain
      responses:
        "200":
          description: A paginated list of alerts
          content:
            application/json:
              schema:
                type: object
                properties:
                  alerts:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        targetName:
                          type: string
                        domain:
                          type: string
                        subdomain:
                          type: string
                        score:
                          type: integer
                          description: Severity score (0 = informational, 1 = low, 2 = medium, 3 = high, 4 = critical)
                        confirmed:
                          type: boolean
                        description:
                          type: string
                        endpoint:
                          type: string
                        createdAt:
                          type: string
                          format: date-time
                  total:
                    type: integer
                    description: Total number of alerts available
                  page:
                    type: integer
                    description: Current page (1-based)
                  pageSize:
                    type: integer
                    description: Number of alerts per page (max 25)
        "401":
          description: Unauthorized
    post:
      summary: Create a new alert
      tags:
        - Alerts
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - targetId
                - name
                - subdomain
                - score
                - description
                - endpoint
              properties:
                targetId:
                  type: integer
                name:
                  type: string
                subdomain:
                  type: string
                score:
                  type: integer
                  minimum: 0
                  maximum: 4
                confirmed:
                  type: boolean
                  default: false
                description:
                  type: string
                endpoint:
                  type: string
      responses:
        "201":
          description: Alert created successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /alerts/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Alert ID
    delete:
      summary: Delete an alert
      tags:
        - Alerts
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Alert deleted successfully
        "404":
          description: Alert not found
        "401":
          description: Unauthorized
  /modules:
    get:
      summary: Retrieve a list of loaded modules
      tags:
        - Modules
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of loaded modules
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: "module-1"
                    name:
                      type: string
                      example: "Module One"
                    version:
                      type: string
                      example: "1.0.0"
                    description:
                      type: string
                      example: "This is a sample module."
                    settings:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                            example: "feature1"
                          type:
                            type: string
                            enum: [checkbox, text, select, info]
                            example: "checkbox"
                          label:
                            type: string
                            example: "Enable Feature 1"
                          default:
                            type: string
                            example: "true"
                          options:
                            type: array
                            items:
                              type: string
                            example: ["option1", "option2", "option3"]
  /modules/{id}/settings:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Module ID
    post:
      summary: Update settings for a module
      tags:
        - Modules
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: "feature1"
                  type:
                    type: string
                    enum: [checkbox, text, select, info]
                    example: "checkbox"
                  label:
                    type: string
                    example: "Enable Feature 1"
                  default:
                    type: string
                    example: "true"
                  value:
                    type: string
                    example: "false"
                  options:
                    type: array
                    items:
                      type: string
                    example: ["option1", "option2", "option3"]
      responses:
        "200":
          description: Module settings updated successfully
        "400":
          description: Invalid request
        "404":
          description: Module not found
        "401":
          description: Unauthorized
  # Tasks
  /tasks/templates:
    get:
      summary: Retrieve all task templates
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of task templates
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    moduleId:
                      type: string
                      example: "subfinder-module"
                    uniqueKey:
                      type: string
                      example: "subdomain-scan"
                    name:
                      type: string
                      example: "Subdomain Discovery"
                    description:
                      type: string
                      example: "Discover subdomains using Subfinder"
                    interval:
                      type: integer
                      description: Interval in seconds between task executions
                      example: 86400
                    active:
                      type: boolean
                      description: Whether the task template is globally active
                      example: true
        "401":
          description: Unauthorized
  /tasks/templates/{moduleId}:
    parameters:
      - name: moduleId
        in: path
        required: true
        schema:
          type: string
        description: Module ID
    get:
      summary: Retrieve task templates by module ID
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of task templates for the specified module
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    moduleId:
                      type: string
                      example: "subfinder-module"
                    uniqueKey:
                      type: string
                      example: "subdomain-scan"
                    name:
                      type: string
                      example: "Subdomain Discovery"
                    description:
                      type: string
                      example: "Discover subdomains using Subfinder"
                    interval:
                      type: integer
                      description: Interval in seconds between task executions
                      example: 86400
                    active:
                      type: boolean
                      description: Whether the task template is globally active
                      example: true
        "401":
          description: Unauthorized
  /tasks/templates/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task Template ID
    patch:
      summary: Update task template (activation and/or interval)
      description: Update a task template's active status and/or execution interval. When interval is updated, all scheduled tasks for this template are automatically resynchronized.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                active:
                  type: boolean
                  description: Set to true to activate globally, false to deactivate
                  example: true
                interval:
                  type: integer
                  description: Interval in seconds between task executions. Must be a positive integer.
                  minimum: 1
                  example: 3600
              oneOf:
                - required: [active]
                - required: [interval]
                - required: [active, interval]
      responses:
        "200":
          description: Template updated successfully
        "404":
          description: Template not found
        "400":
          description: Invalid request (at least one of 'active' or 'interval' must be provided)
        "401":
          description: Unauthorized

    delete:
      summary: Delete task template
      description: Deletes a task template and unregisters all associated scheduled tasks.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Template deleted successfully
        "404":
          description: Template not found
        "401":
          description: Unauthorized

  /tasks/templates/{id}/run:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task Template ID
    post:
      summary: Run task template immediately
      description: Enqueues executions for the template immediately (CUSTOM templates trigger their onSchedule callback).
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Template enqueued successfully
        "404":
          description: Template not found
        "401":
          description: Unauthorized
  /tasks/templates/{id}/run/{targetId}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task Template ID
      - name: targetId
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    post:
      summary: Run task template immediately for a specific target
      description: Enqueues executions for the template immediately (CUSTOM templates trigger their onManualTrigger callback).
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Template enqueued successfully for the specific target
        "404":
          description: Template not found or Target not found or not compatible
        "401":
          description: Unauthorized
  /tasks/targets/{targetId}/task-overrides:
    parameters:
      - name: targetId
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get task overrides for a specific target
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: List of task overrides for the target
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    targetId:
                      type: integer
                      example: 5
                    taskTemplateId:
                      type: integer
                      example: 2
                    active:
                      type: boolean
                      description: Whether this task is active for this specific target
                      example: false
        "401":
          description: Unauthorized
    put:
      summary: Batch set task overrides for a target
      description: Set the active status for multiple task templates on a specific target. This allows enabling or disabling multiple tasks at once.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              items:
                type: object
                required:
                  - templateId
                  - active
                properties:
                  templateId:
                    type: integer
                    minimum: 1
                    example: 1
                  active:
                    type: boolean
                    example: true
      responses:
        "200":
          description: Overrides set successfully
        "400":
          description: Invalid request (empty array, invalid IDs, etc.)
        "500":
          description: Some overrides failed to set
        "401":
          description: Unauthorized
    delete:
      summary: Batch remove task overrides for a target
      description: Remove overrides for multiple task templates, reverting them to the global active/inactive state.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - templateIds
              properties:
                templateIds:
                  type: array
                  items:
                    type: integer
                  minItems: 1
                  description: Array of task template IDs to remove overrides for
                  example: [1, 3]
      responses:
        "200":
          description: Overrides removed successfully
        "400":
          description: Invalid request (empty array, invalid IDs, etc.)
        "500":
          description: Some overrides failed to delete
        "401":
          description: Unauthorized
  # Settings
  /settings:
    get:
      summary: Get all application settings
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Application settings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workerKey:
                    type: string
                    example: "abc123def456"
                  burpsuiteKey:
                    type: string
                    example: "xyz789uvw012"
                  enableSwaggerUi:
                    type: boolean
                    example: true
                  externalUrl:
                    type: string
                    example: "https://deepbounty.mydomain.com"
        "401":
          description: Unauthorized
    patch:
      summary: Update application settings
      tags:
        - Settings
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                swaggerUi:
                  type: boolean
                  example: true
                externalUrl:
                  type: string
                  example: "https://deepbounty.mydomain.com"
      responses:
        "200":
          description: Settings updated successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /settings/regenerate/worker-key:
    post:
      summary: Regenerate worker authentication key
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Worker key regenerated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workerKey:
                    type: string
                    example: "new-worker-key-123"
        "401":
          description: Unauthorized
  /settings/regenerate/burpsuite-key:
    post:
      summary: Regenerate Burp Suite authentication key
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Burp Suite key regenerated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  burpsuiteKey:
                    type: string
                    example: "new-burpsuite-key-456"
        "401":
          description: Unauthorized
  /settings/reset-modules:
    post:
      summary: Reset all module databases
      description: Clears all module-specific data and resets their databases
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Module databases reset successfully
        "401":
          description: Unauthorized
  /settings/cleanup-tasks:
    post:
      summary: Clean up completed tasks
      description: Removes old completed tasks from the database
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Tasks cleaned up successfully
        "401":
          description: Unauthorized
  /settings/restart-server:
    post:
      summary: Restart the server
      description: Gracefully restarts the application server
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Server restart initiated
        "401":
          description: Unauthorized
  # Notifications
  /notifications:
    get:
      summary: Get all notification providers with their current configuration
      description: Returns all available notification providers (Discord, ntfy.sh) along with their configuration schema and current values
      tags:
        - Notifications
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Notification providers with configuration
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    label:
                      type: string
                      example: "Discord"
                    fields:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                            example: "webhookUrl"
                          label:
                            type: string
                            example: "Webhook URL"
                          type:
                            type: string
                            enum: [text, password, url]
                            example: "url"
                          placeholder:
                            type: string
                            example: "https://discord.com/api/webhooks/..."
                          required:
                            type: boolean
                            example: true
                    config:
                      type: object
                      description: Current configuration values
                      example: { "webhookUrl": "https://discord.com/api/webhooks/123/abc" }
                    enabled:
                      type: boolean
                      description: Whether this notification service is enabled
                      example: true
              example:
                discord:
                  label: "Discord"
                  fields:
                    - name: "webhookUrl"
                      label: "Webhook URL"
                      type: "url"
                      placeholder: "https://discord.com/api/webhooks/..."
                      required: true
                  config:
                    webhookUrl: "https://discord.com/api/webhooks/123/abc"
                  enabled: true
                ntfysh:
                  label: "ntfy.sh"
                  fields:
                    - name: "topic"
                      label: "Topic"
                      type: "text"
                      placeholder: "your-topic"
                      required: true
                    - name: "apiKey"
                      label: "API Key"
                      type: "password"
                      placeholder: "Optional API key for authentication"
                      required: false
                  config: {}
                  enabled: false
        "401":
          description: Unauthorized
  /notifications/{provider}:
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [discord, ntfysh]
        description: Notification provider name
    put:
      summary: Create or update a notification service configuration
      description: Configure a notification service with the required credentials and enable/disable it
      tags:
        - Notifications
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - config
                - enabled
              properties:
                config:
                  type: object
                  description: Provider-specific configuration
                  oneOf:
                    - title: Discord Configuration
                      type: object
                      required:
                        - webhookUrl
                      properties:
                        webhookUrl:
                          type: string
                          format: uri
                          example: "https://discord.com/api/webhooks/123456789/abcdefghijklmnop"
                    - title: ntfy.sh Configuration
                      type: object
                      required:
                        - topic
                      properties:
                        topic:
                          type: string
                          example: "my-bug-bounty-alerts"
                        apiKey:
                          type: string
                          example: "tk_abc123def456"
                enabled:
                  type: boolean
                  description: Whether to enable this notification service
                  example: true
            examples:
              discord:
                summary: Configure Discord webhook
                value:
                  config:
                    webhookUrl: "https://discord.com/api/webhooks/123456789/abcdefghijklmnop"
                  enabled: true
              ntfysh:
                summary: Configure ntfy.sh topic
                value:
                  config:
                    topic: "my-bug-bounty-alerts"
                    apiKey: "tk_abc123def456"
                  enabled: true
      responses:
        "200":
          description: Notification service configured successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  provider:
                    type: string
                    example: "discord"
                  config:
                    type: object
                  enabled:
                    type: boolean
                    example: true
        "400":
          description: Invalid request or configuration
        "401":
          description: Unauthorized
  /notifications/{provider}/test:
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [discord, ntfysh]
        description: Notification provider name
    post:
      summary: Test a notification service configuration
      description: Send a test notification using the currently saved configuration for the provider
      tags:
        - Notifications
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Test notification sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Test notification sent successfully"
        "400":
          description: Failed to send test notification (invalid configuration, network error, etc.)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to send test notification"
                  details:
                    type: string
                    example: "Discord webhook test failed: 404 Not Found"
        "404":
          description: Notification service not configured
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Notification service not configured"
                  details:
                    type: string
                    example: "No configuration found for provider 'discord'"
        "401":
          description: Unauthorized
  # Ingest
  /ingest:
    post:
      summary: Ingest traffic data from Burp Suite / Caido
      description: Receives HTTP traffic data from Burp Suite / Caido extension and logs it for processing
      tags:
        - Ingest
      security:
        - sessionCookie: []
        - burpsuiteKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
                - method
                - statusCode
                - mimeType
              properties:
                url:
                  type: string
                  description: The request URL
                  example: "https://example.com/api/users"
                method:
                  type: string
                  description: The HTTP method
                  example: "GET"
                statusCode:
                  type: integer
                  description: The HTTP status code
                  example: 200
                requestHeaders:
                  type: object
                  additionalProperties:
                    type: string
                  description: The request headers
                  example: { "User-Agent": "Mozilla/5.0", "Accept": "application/json" }
                responseHeaders:
                  type: object
                  additionalProperties:
                    type: string
                  description: The response headers
                  example: { "Content-Type": "application/json", "Content-Length": "1234" }
                requestBody:
                  type: string
                  description: The request body
                  example: ""
                responseBody:
                  type: string
                  description: The response body
                  example: '{"users": []}'
                mimeType:
                  type: string
                  description: The MIME type
                  example: "application/json"
      responses:
        "200":
          description: Traffic data received and logged successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "400":
          description: Invalid request data
        "401":
          description: Unauthorized
        "500":
          description: Internal server error
  # Scope
  /scope:
    get:
      summary: Get all scan-enabled subdomains
      description: Returns all subdomains from targets with activeScan enabled, for Burp Suite integration
      tags:
        - Scope
      security:
        - sessionCookie: []
        - burpsuiteKey: []
      responses:
        "200":
          description: Scope data with version and subdomains
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: integer
                    description: Current scope version, increments on any scope change
                    example: 42
                  subdomains:
                    type: array
                    items:
                      type: string
                    description: Array of all subdomains from targets with activeScan enabled
                    example: ["api.example.com", "www.example.com", "admin.test.com"]
        "401":
          description: Unauthorized
        "500":
          description: Internal server error
  /scope/version:
    get:
      summary: Get current scope version (lightweight polling)
      description: Returns only the version number to check if scope has changed. Optimized for frequent polling (e.g., every 10 seconds)
      tags:
        - Scope
      security:
        - sessionCookie: []
        - burpsuiteKey: []
      responses:
        "200":
          description: Current scope version
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: integer
                    description: Current scope version, increments on any scope change
                    example: 42
        "401":
          description: Unauthorized
        "500":
          description: Internal server error
  # Workers
  /workers:
    get:
      summary: Get all connected workers
      tags:
        - Workers
      security:
        - sessionCookie: []
      responses:
        "200":
          description: List of connected workers
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: "worker-1"
                    ip:
                      type: string
                      example: "192.168.1.100"
                    connectedAt:
                      type: string
                      format: date-time
                    tasksCount:
                      type: integer
                      example: 5
                    toolsCount:
                      type: integer
                      example: 12
                    aggressiveMode:
                      type: boolean
                      example: false
        "401":
          description: Unauthorized
  /workers/{id}/disconnect:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Worker ID
    post:
      summary: Disconnect a worker
      tags:
        - Workers
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Worker disconnected successfully
        "404":
          description: Worker not found
        "401":
          description: Unauthorized
  # Callbacks
  /cb/{uuid}:
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Callback UUID
    post:
      summary: Trigger a module callback (public endpoint)
      description: |
        Public endpoint for external systems to trigger registered callbacks.
        Used for out-of-band exfiltration detection.
        This endpoint does not require authentication.
      tags:
        - Callbacks
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: Arbitrary JSON payload from the external caller
              additionalProperties: true
              example:
                hostname: "target-server.example.com"
                ip: "192.168.1.100"
                user: "root"
      responses:
        "200":
          description: Callback processed
