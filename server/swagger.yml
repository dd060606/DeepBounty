openapi: 3.0.0
info:
  title: DeepBounty API
  version: 1.0.0
  description: DeepBounty API Documentation

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: connect.sid

paths:
  #Setup
  /setup/password:
    post:
      summary: Set up a password to protect the dashboard
      tags:
        - Setup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  minLength: 12
                  pattern: "^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[^A-Za-z0-9]).+$"
      responses:
        "200":
          description: Password setup successful
          headers:
            Set-Cookie:
              description: Session cookie when the password is set up
              schema:
                type: string
              example: "connect.sid=abc123; Path=/; HttpOnly; SameSite=Lax; Secure"
        "400":
          description: Invalid password
  #Auth
  /auth/login:
    post:
      summary: User login
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
      responses:
        "200":
          description: Login successful
          headers:
            Set-Cookie:
              description: Session cookie set on successful login
              schema:
                type: string
              example: "connect.sid=abc123; Path=/; HttpOnly; SameSite=Lax; Secure"
        "401":
          description: Invalid password
  /auth/logout:
    post:
      summary: User logout
      tags:
        - Auth
      responses:
        "200":
          description: Logout successful
  /auth/info:
    get:
      summary: Get current authentication info
      tags:
        - Auth
      responses:
        "200":
          description: Authentication status
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  status:
                    type: string
                    description: Current auth status. Depends on whether setup is complete and whether a valid session cookie is present.
                    enum: [authenticated, unauthenticated, setup-required]
  #Targets
  /targets:
    get:
      summary: Retrieve a list of targets
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of targets
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: "Target Name"
                    domain:
                      type: string
                      example: "example.com"
                    activeScan:
                      type: boolean
                      example: true
        "401":
          description: Unauthorized
    post:
      summary: Add a new target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - domain
              properties:
                name:
                  type: string
                  example: "New Target"
                domain:
                  type: string
                  example: "example.com"
                activeScan:
                  type: boolean
                  example: true
      responses:
        "201":
          description: Target created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 2
                  name:
                    type: string
                    example: "New Target"
                  domain:
                    type: string
                    example: "example.com"
                  activeScan:
                    type: boolean
                    example: true
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /targets/full:
    get:
      summary: Retrieve all targets with their subdomains and settings
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of targets with relations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: "Target Name"
                    domain:
                      type: string
                      example: "example.com"
                    activeScan:
                      type: boolean
                      example: true
                    subdomains:
                      type: array
                      items:
                        type: string
                      example: ["a.example.com", "b.example.com"]
                    settings:
                      type: object
                      nullable: true
                      description: Arbitrary JSON settings for the target
        "401":
          description: Unauthorized
  /targets/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    patch:
      summary: Update an existing target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Updated Target"
                domain:
                  type: string
                  example: "example.com"
                activeScan:
                  type: boolean
                  example: true
      responses:
        "200":
          description: Target updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: "Updated Target"
                  domain:
                    type: string
                    example: "example.com"
                  activeScan:
                    type: boolean
                    example: true
        "400":
          description: Invalid request
        "404":
          description: Target not found
        "401":
          description: Unauthorized
    delete:
      summary: Delete an existing target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Target deleted successfully
        "404":
          description: Target not found
        "401":
          description: Unauthorized
  /targets/{id}/subdomains:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get subdomains for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of subdomains for the target
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  example: "sub.example.com"
        "401":
          description: Unauthorized
    post:
      summary: Add subdomains to a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                example: "sub.example.com"
      responses:
        "200":
          description: Subdomains added successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /targets/{id}/settings:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get settings for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Settings rows for the target
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                example: { userAgent: "Mozilla/5.0", customHeader: "X-BugBounty: <username>" }

        "401":
          description: Unauthorized
    post:
      summary: Replace settings for a target
      tags:
        - Targets
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              example: { userAgent: "Mozilla/5.0", customHeader: "X-BugBounty: <username>" }
      responses:
        "200":
          description: Settings saved successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  # Alerts
  /alerts:
    get:
      summary: Retrieve a list of alerts
      tags:
        - Alerts
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of alerts
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    targetName:
                      type: string
                    domain:
                      type: string
                    subdomain:
                      type: string
                    score:
                      type: integer
                      description: Severity score (0 = informational, 1 = low, 2 = medium, 3 = high, 4 = critical)
                    confirmed:
                      type: boolean
                    description:
                      type: string
                    endpoint:
                      type: string
                    createdAt:
                      type: string
                      format: date-time
        "401":
          description: Unauthorized
    post:
      summary: Create a new alert
      tags:
        - Alerts
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - targetId
                - name
                - subdomain
                - score
                - description
                - endpoint
              properties:
                targetId:
                  type: integer
                name:
                  type: string
                subdomain:
                  type: string
                score:
                  type: integer
                  minimum: 0
                  maximum: 4
                confirmed:
                  type: boolean
                  default: false
                description:
                  type: string
                endpoint:
                  type: string
      responses:
        "201":
          description: Alert created successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /alerts/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Alert ID
    delete:
      summary: Delete an alert
      tags:
        - Alerts
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Alert deleted successfully
        "404":
          description: Alert not found
        "401":
          description: Unauthorized
  /modules:
    get:
      summary: Retrieve a list of loaded modules
      tags:
        - Modules
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of loaded modules
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: "module-1"
                    name:
                      type: string
                      example: "Module One"
                    version:
                      type: string
                      example: "1.0.0"
                    description:
                      type: string
                      example: "This is a sample module."
                    settings:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                            example: "feature1"
                          type:
                            type: string
                            enum: [checkbox, text, select, info]
                            example: "checkbox"
                          label:
                            type: string
                            example: "Enable Feature 1"
                          default:
                            type: string
                            example: "true"
                          options:
                            type: array
                            items:
                              type: string
                            example: ["option1", "option2", "option3"]
  /modules/{id}/settings:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Module ID
    post:
      summary: Update settings for a module
      tags:
        - Modules
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: "feature1"
                  type:
                    type: string
                    enum: [checkbox, text, select, info]
                    example: "checkbox"
                  label:
                    type: string
                    example: "Enable Feature 1"
                  default:
                    type: string
                    example: "true"
                  value:
                    type: string
                    example: "false"
                  options:
                    type: array
                    items:
                      type: string
                    example: ["option1", "option2", "option3"]
      responses:
        "200":
          description: Module settings updated successfully
        "400":
          description: Invalid request
        "404":
          description: Module not found
        "401":
          description: Unauthorized
  # Tasks
  /tasks/templates:
    get:
      summary: Retrieve all task templates
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of task templates
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    moduleId:
                      type: string
                      example: "subfinder-module"
                    uniqueKey:
                      type: string
                      example: "subdomain-scan"
                    name:
                      type: string
                      example: "Subdomain Discovery"
                    description:
                      type: string
                      example: "Discover subdomains using Subfinder"
                    interval:
                      type: integer
                      description: Interval in seconds between task executions
                      example: 86400
                    active:
                      type: boolean
                      description: Whether the task template is globally active
                      example: true
        "401":
          description: Unauthorized
  /tasks/templates/{moduleId}:
    parameters:
      - name: moduleId
        in: path
        required: true
        schema:
          type: string
        description: Module ID
    get:
      summary: Retrieve task templates by module ID
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: A list of task templates for the specified module
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    moduleId:
                      type: string
                      example: "subfinder-module"
                    uniqueKey:
                      type: string
                      example: "subdomain-scan"
                    name:
                      type: string
                      example: "Subdomain Discovery"
                    description:
                      type: string
                      example: "Discover subdomains using Subfinder"
                    interval:
                      type: integer
                      description: Interval in seconds between task executions
                      example: 86400
                    active:
                      type: boolean
                      description: Whether the task template is globally active
                      example: true
        "401":
          description: Unauthorized
  /tasks/templates/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task Template ID
    patch:
      summary: Update task template (activation and/or interval)
      description: Update a task template's active status and/or execution interval. When interval is updated, all scheduled tasks for this template are automatically resynchronized.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                active:
                  type: boolean
                  description: Set to true to activate globally, false to deactivate
                  example: true
                interval:
                  type: integer
                  description: Interval in seconds between task executions. Must be a positive integer.
                  minimum: 1
                  example: 3600
              oneOf:
                - required: [active]
                - required: [interval]
                - required: [active, interval]
      responses:
        "200":
          description: Template updated successfully
        "404":
          description: Template not found
        "400":
          description: Invalid request (at least one of 'active' or 'interval' must be provided)
        "401":
          description: Unauthorized
  /tasks/targets/{targetId}/task-overrides:
    parameters:
      - name: targetId
        in: path
        required: true
        schema:
          type: integer
        description: Target ID
    get:
      summary: Get task overrides for a specific target
      tags:
        - Tasks
      security:
        - sessionCookie: []
      responses:
        "200":
          description: List of task overrides for the target
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    targetId:
                      type: integer
                      example: 5
                    taskTemplateId:
                      type: integer
                      example: 2
                    active:
                      type: boolean
                      description: Whether this task is active for this specific target
                      example: false
        "401":
          description: Unauthorized
    put:
      summary: Batch set task overrides for a target
      description: Set the active status for multiple task templates on a specific target. This allows enabling or disabling multiple tasks at once.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              items:
                type: object
                required:
                  - templateId
                  - active
                properties:
                  templateId:
                    type: integer
                    minimum: 1
                    example: 1
                  active:
                    type: boolean
                    example: true
      responses:
        "200":
          description: Overrides set successfully
        "400":
          description: Invalid request (empty array, invalid IDs, etc.)
        "500":
          description: Some overrides failed to set
        "401":
          description: Unauthorized
    delete:
      summary: Batch remove task overrides for a target
      description: Remove overrides for multiple task templates, reverting them to the global active/inactive state.
      tags:
        - Tasks
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - templateIds
              properties:
                templateIds:
                  type: array
                  items:
                    type: integer
                  minItems: 1
                  description: Array of task template IDs to remove overrides for
                  example: [1, 3]
      responses:
        "200":
          description: Overrides removed successfully
        "400":
          description: Invalid request (empty array, invalid IDs, etc.)
        "500":
          description: Some overrides failed to delete
        "401":
          description: Unauthorized
  # Settings
  /settings:
    get:
      summary: Get all application settings
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Application settings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workerKey:
                    type: string
                    example: "abc123def456"
                  burpsuiteKey:
                    type: string
                    example: "xyz789uvw012"
                  scanAllSubdomains:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
    patch:
      summary: Update application settings
      tags:
        - Settings
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                scanAllSubdomains:
                  type: boolean
                  example: true
      responses:
        "200":
          description: Settings updated successfully
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
  /settings/regenerate/worker-key:
    post:
      summary: Regenerate worker authentication key
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Worker key regenerated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workerKey:
                    type: string
                    example: "new-worker-key-123"
        "401":
          description: Unauthorized
  /settings/regenerate/burpsuite-key:
    post:
      summary: Regenerate Burp Suite authentication key
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Burp Suite key regenerated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  burpsuiteKey:
                    type: string
                    example: "new-burpsuite-key-456"
        "401":
          description: Unauthorized
  /settings/reset-modules:
    post:
      summary: Reset all module databases
      description: Clears all module-specific data and resets their databases
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Module databases reset successfully
        "401":
          description: Unauthorized
  /settings/cleanup-tasks:
    post:
      summary: Clean up completed tasks
      description: Removes old completed tasks from the database
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Tasks cleaned up successfully
        "401":
          description: Unauthorized
  /settings/restart-server:
    post:
      summary: Restart the server
      description: Gracefully restarts the application server
      tags:
        - Settings
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Server restart initiated
        "401":
          description: Unauthorized
  # Workers
  /workers:
    get:
      summary: Get all connected workers
      tags:
        - Workers
      security:
        - sessionCookie: []
      responses:
        "200":
          description: List of connected workers
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: "worker-1"
                    status:
                      type: string
                      example: "connected"
                    connectedAt:
                      type: string
                      format: date-time
                    lastSeen:
                      type: string
                      format: date-time
        "401":
          description: Unauthorized
  /workers/{id}/disconnect:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Worker ID
    post:
      summary: Disconnect a worker
      tags:
        - Workers
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Worker disconnected successfully
        "404":
          description: Worker not found
        "401":
          description: Unauthorized
